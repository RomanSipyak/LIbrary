<div class='row' style='margin-bottom: 12px '>
  <div class='col col-md-3 '>
    <button type='button' class='btn btn-info btn-ms' data-toggle='modal' data-target='#myModal'>
      Фільтр
    </button>
  </div>
</div>
<div class='row'>
  <!-- Modal -->
  <div id='myModal' class='modal fade' role='dialog'>
    <div class='modal-dialog'>
      <!-- Modal content-->
      <div class='modal-content'>
        <div class='modal-header'>
          <button type='button' class='close' data-dismiss='modal'>&times;</button>
          <h4 class='modal-title'>Фільтр для книг</h4>
        </div>
        <div class='modal-body'>
          <%= form_tag for_user_books_path, method: :get do %>
            <div class='panel-group'>
              <div class='panel panel-default'>
                <div class='panel-heading'>
                  <h4 class='panel-title'>
                    <!--                    <a data-toggle='collapse' href='#collapse1'>Languages</a>-->
                    <a data-toggle='collapse' href='#collapse1'>Мови</a>
                  </h4>
                </div>
                <div id='collapse1' class='panel-collapse collapse'>
                  <div class='panel-body'>
                    <% @languages.each do |language| %>
                      <%= check_box_tag 'by_language_ids[]', language.id %>
                      <%= h language.language %>;
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
            <div class='panel-group'>
              <div class='panel panel-default'>
                <div class='panel-heading'>
                  <h4 class='panel-title'>
                    <!--                    <a data-toggle='collapse' href='#collapse2'>Authors</a>-->
                    <a data-toggle='collapse' href='#collapse2'>Автори</a>
                  </h4>
                </div>
                <div id='collapse2' class='panel-collapse collapse'>
                  <div class='panel-body'>
                    <% @authors.each do |author| %>
                      <%= check_box_tag 'by_authors_ids[]', author.id %>
                      <%= h author.name %>;
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
            <div class='panel-group'>
              <div class='panel panel-default'>
                <div class='panel-heading'>
                  <h4 class='panel-title'>
                    <!--                    <a data-toggle='collapse' href='#collapse3'>Categories</a>-->
                    <a data-toggle='collapse' href='#collapse3'>Категорії</a>
                  </h4>
                </div>
                <div id='collapse3' class='panel-collapse collapse'>
                  <div class='panel-body'>
                    <% @categories.all.each do |categories| %>
                      <%= check_box_tag 'by_category_ids[]', categories.id %>
                      <%= h categories.title %>;
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
            <div class='row'>
              <div class='col-md-12' style="padding-bottom: 5px">
                <%= text_field_tag 'by_title_or_name_for_author', params[:by_title_or_name_for_author],
                                   # placeholder: 'code\name_title\name_author'
                                   placeholder: 'назва книги\ім\'я автора',
                                   class: 'form-control col-md-6',
                                   style: 'width: 220px' %>
              </div>
            </div>
            <div class='col-md-6'>
              <!--              <%#= label_tag(:year, 'Year of release') %><br>-->
              <%= label_tag(:year, 'Рік випуску') %><br>
              <%= select_tag :by_year, options_for_select(@years, @years.last[1]) %>
              <!--              <div><%#= submit_tag 'Save' %></div>-->
              <div><%= submit_tag 'Зберегти' %></div>
            </div>
          <% end %>
          <div class='modal-footer'>
            <button type='button' class='btn btn-default' data-dismiss='modal'>Закрити</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Modal -->
<div class='container-fluid cards-row'>
  <div class='row'>
    <% @books.each do |book| %>
      <div class='col-sm-6 col-md-4 article'>
        <div class='thumbnail' style='outline-style: solid; outline-radius: 7px; background-color: #ddaa68e6;  max-height: 300px; overflow-y: auto'>
          <%= image_tag book.image_url, class: "img-responsive" if book.image_url %>
          <div class='caption'
               <% if @free_units_count[book] > 0 %> style='border-radius: 7px;background-color: #28a745a6'
               <% else %>
               style='border-radius: 7px;background-color: #da7916b8'
               <% end %>
               >
            <h3>Tile Of Book:
              <td style='word-break: break-all;'><%= link_to book.title, for_user_book_path(book.id) %></td>
            </h3>
            <p class='card-description'>
              <strong>Рік випуску:<%= book.year %></strong><br>
              <% unless book.author.nil? || book.author.name.nil? %>
                <!--                <strong>Author:  <%#= book.author.name %></strong><br>-->
                <strong>Автор:  <%= book.author.name %></strong><br>
              <% else %>
                <!--                <strong>Author: not exist</strong><br>-->
                <strong>Автор: не існує</strong><br>
              <% end %>
              <% unless book.language.nil? || book.language.language.nil? %>
                <!--                <strong>Language:  <%#= book.language.language %></strong><br>-->
                <strong>Мова:  <%= book.language.language %></strong><br>
              <% else %>
                <!--                <strong>Language: not exist</strong><br>-->
                <strong>Мова: не існує</strong><br>
              <% end %>
              <% unless book.category.nil? || book.category.title.nil? %>
                <strong>Категорія:  <%= book.category.title %></strong><br>
              <% else %>
                <strong>Категорія: не існує</strong><br>
              <% end %>

              <!--              <strong>Rating:  <%#= book.rating %></strong><br>-->
              <!--              <strong>Count of Free:</strong> <%#= @free_units_count[book] %>\<%#= book.units_count %></p>-->
              <strong>Рейтинг:  <%= book.rating %></strong><br>
              <strong>Кількість вільних екземплярів:</strong> <%= @free_units_count[book] %>\<%= book.units_count %>
              <% unless current_user %>
                <!--              <p>If you want do order you should to autorize</p>-->
              <p>Якщо ви хочете замовити книгу вам потрібно авторизуватись</p>
            <% else %>
              <% if @free_units_count[book] > 0 %>
                <% if current_user.bookings.by_status(:taken).count < 4 %>
                  <% if current_user.bookings.by_status(:owed).count == 0 %>
                    <%= form_with url: for_user_bookings_path do |form| %>
                      <%= hidden_field_tag(:book_id, book.id) %>
                      <%#= form.submit 'Do order', class: 'btn btn-success fa fa-check fa-1' %>
                      <%= form.submit 'Зробити замовлення', class: 'btn btn-success fa fa-check fa-1' %>
                    <% end %>
                  <% else %>
                    <!--                    <p>You are debtor</p>-->
                    <p>Ви боржник</p>
                  <% end %>
                <% else %>
                  <!--                  <p>You have too much bookings</p>-->
                  <p>У вас за багато замовлень</p>
                <% end %>
              <% else %>
                <!--                <p>Not have free books</p>-->
                <p>Не має вільних екземплярів книги</p>
              <% end %>
            <% end %>
          </div>
          <%= @msg %>
        </div>
      </div>
    <% end %>
  </div>
  <nav class="navbar  navbar-bottom ">
    <div class="text-center">
      <% unless @books.empty? %>
        <%= paginate @books, outer_window: 3, class: "pagination" %>
      <% end %>
    </div>
  </nav>
</div>

